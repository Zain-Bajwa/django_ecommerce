{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&display=swap"
    rel="stylesheet">
  <title>{% block title %}{% endblock %}</title>
  <!-- Bootstrap core CSS -->
  <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <!--
assets/css/fontawesome.css
TemplateMo 546 Sixteen Clothing

-->
  <style>
    .badge:after {
      content: attr(value);
      font-size: 16px;
      color: #fff;
      background: #F33F3F;
      border-radius: 50%;
      padding: 0 1px;
      position: relative;
      left: -8px;
      top: -10px;
      opacity: 0.9;
    }
    .gradient-custom {
      /* fallback for old browsers */
      background: #F33F3F;
      
      /* Chrome 10-25, Safari 5.1-6 */
      background: -webkit-linear-gradient(to right, rgba(106, 17, 203, 1), #F33F3F);
      
      /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
      background: linear-gradient(to right, rgba(106, 17, 203, 1), #F33F3F)
      }
  </style>

  <!-- Additional CSS Files -->
  <link rel="stylesheet" href="{% static 'assets/css/fontawesome.css' %}">
  <link rel="stylesheet" href="{% static 'assets/css/templatemo-sixteen.css' %}">
  <link rel="stylesheet" href="{% static 'assets/css/owl.css' %}">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css">

</head>

<body>

  <!-- ***** Preloader Start ***** -->
  <div id="preloader">
    <div class="jumper">
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
  <!-- ***** Preloader End ***** -->

  <!-- Header -->
  {% block header %}
  <header class="">
    <nav class="navbar navbar-expand-lg">
      <a class="navbar-brand p-3" href="#">
        <img class="rounded-circle z-depth-2" src="{% static 'media/logo/brand.png' %}" width="30" height="30" alt="">
      </a>
      <div class="container">
        <a class="navbar-brand" href="{% url 'core:home-view' %}">
          <h2>Sixteen <em>Elo</em></h2>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
          aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item {% block home_active %}{% endblock %}">
              <a class="nav-link" href="{% url 'core:home-view' %}">Home
                <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item {% block product_active %}{% endblock %}">
              <a class="nav-link" href="{% url 'core:products-view' %}">Our Products</a>
            </li>
            <li class="nav-item {% block about_active %}{% endblock %}">
              <a class="nav-link" href="{% url 'core:about-view' %}">About Us</a>
            </li>
            <li class="nav-item {% block contact_active %}{% endblock %}">
              <a class="nav-link" href="{% url 'core:contact-view' %}">Contact US</a>
            </li>
            <li class="nav-item" id="login">
              <a class="nav-link" href="{% url 'authentication:login-view' %}">Login</a>
            </li>
            <li class="nav-item d-none" id="logout">
              <a class="nav-link" href="#" onclick="logout()">Logout</a>
            </li>
            <li class="nav-item active" id="">
              <span class="fa-stack" data-count="5">
                <i class="fa badge active" id="cart_count" value=0>&#xf290;</i>
                <a style="color: #F33F3F" class="fa fa-shopping-cart fa-stack-2x pt-2" id="cart-count-link"
                  href="javascript:void(0)"></a>
              </span>
            </li>
          </ul>
        </div>
      </div>
      <div class="pt-0 navbar-collapse">
        <ul class="pt-0 navbar-nav ml-auto">
          <a class="py-2" href="{% url 'core:profile-view' %}">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor"
              class="bi bi-person-circle" viewBox="0 0 16 16">
              <path style="color: #F33F3F;" d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
              <path style="color: #F33F3F;" fill-rule="evenodd"
                d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
            </svg>
          </a>
          <li style="margin-left: 0px;" class="nav-item">
            <a class="nav-link" id="user-name"></a>
          </li>
        </ul>
      </div>
    </nav>
  </header>
  {% endblock %}

  <!-- Page Content -->
  <!-- Banner Starts Here -->
  {% block content %}{% endblock %}
  <!-- Footer -->
  {% block footer %}
  
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="inner-content">
            <p>Copyright &copy; {% now "Y" %}
          
          - Design: <a rel="nofollow noopener" href="#" target="_blank">Betatesting</a></p>
          </div>
        </div>
      </div>
    </div>
  </footer>
  
  {% endblock %}
  <!-- Bootstrap core JavaScript -->
  <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
  <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.32/dist/sweetalert2.all.min.js"></script>


  <!-- Additional Scripts -->
  <script src="{% static 'assets/js/custom.js' %}"></script>
  <script src="{% static 'assets/js/owl.js' %}"></script>
  <script src="{% static 'assets/js/slick.js' %}"></script>
  <script src="{% static 'assets/js/isotope.js' %}"></script>
  <script src="{% static 'assets/js/accordions.js' %}"></script>

  <script>
    // This function is called to clear session storage when user logout
    function logout() {
      sessionStorage.removeItem("access")
      sessionStorage.removeItem("refresh")
      sessionStorage.removeItem("user_id")
      window.location.href = "{% url 'authentication:login-view' %}"
    }

    function isLogin() {
      const Bearer_access = sessionStorage.access
      const Bearer_refresh = sessionStorage.refresh
      const user_id = sessionStorage.user_id
      const header = new Headers({
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + Bearer_access
      });
      if ((Bearer_access != undefined) & (Bearer_refresh != undefined) & (user_id != undefined)) {
        token = {
          "Bearer_access": Bearer_access,
          "Bearer_refresh": Bearer_refresh,
          "user_id": user_id,
          "header": header
        }
        return token;
      }
      else {
        return false
      }
    }

    // Gettin the name of the user
    async function getUser(token) {

      const url = "/auth/user/" + token.user_id
      let response = await fetch(url, {
        method: 'GET',
        headers: token.header
      });

      data = await response.json()
      if (response.ok) {
        document.getElementById("login").classList.add("d-none");
        document.getElementById("logout").classList.remove("d-none");
        document.getElementById("user-name").innerHTML = "Mr. " + data.username
      }
    }

    // Get the number of products in Cat if the user is loged in
    async function getCartCount(token) {

      // url for cart-view. We are counting the number of products in Cart of a user 
      url = "/api/cart/view/" + token.user_id + "/"

      let response = await fetch(url, {
        method: 'GET',
        headers: token.header
      });
      data = await response.json();
      if (response.ok) {
        let counter = 0
        // get count of products if products are in the cart
        for ([key, value] of Object.entries(data)) {
          counter = counter + 1
        }
        // Update the cart value and link of cart
        //debugger
        url = "/cart/" + token.user_id
        document.getElementById("cart_count").setAttribute("value", counter)
        document.getElementById("cart-count-link").href = url
      }
    }

    // Document ready function
    $(document).ready(function () {
      // Getting the name of user and number of product in the cart if user is logedin
      //debugger
      token = isLogin()
      if (token) {
        getUser(token)

        getCartCount(token)
      }

    });

  </script>

  {% block javascript_tag %} {% endblock %}

</body>

</html>